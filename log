BB_STRICT_CHECKSUM = "0"关闭校验和

UBOOT_SRC ?= "git:///home/z/zty/yocto/linshi/uboot-imx;protocol=file"

configure: error: raw selected, but required raw.h header file not available
disable_raw 失能

util-linux-native

| configure: error: failed to recognize APR_INT64_T_FMT on this platform
删除swig.m4 159

| ERROR: User requested feature sdl
|        configure was not able to find it.
|        Install SDL devel
| 
| WARNING: exit code 1 from a shell command.

BUILD_LDFLAGS_prepend_pn-qemu-native = "-Wl,-rpath-link,/lib/x86_64-linux-gnu "


user-exec.c:71:37: error: dereferencing pointer to incomplete type 'struct ucontext'
在{yocto_path}/build-fb/tmp/work/x86_64-linux/qemu-native/2.5.0-r1/qemu-2.5.0/user-exec.c文件中，增加下列定义：

typedef struct ucontext
{
unsigned long int uc_flags;
struct ucontext *uc_link;
__sigset_t uc_sigmask;
stack_t uc_stack;
mcontext_t uc_mcontext;
long int uc_filler[5];
};
————————————————

--- qemu-2.10.0-clean/linux-user/syscall.c	2020-03-12 18:47:47.898592169 +0100
+++ qemu-2.10.0/linux-user/syscall.c	2020-03-12 19:16:41.563074307 +0100
@@ -34,6 +34,7 @@
 #include <sys/resource.h>
 #include <sys/swap.h>
 #include <linux/capability.h>
+#include <linux/sockios.h> // https://lkml.org/lkml/2019/6/3/988
 #include <sched.h>
 #include <sys/timex.h>
 #ifdef __ia64__
@@ -116,6 +117,8 @@ int __clone2(int (*fn)(void *), void *ch
 #include "qemu.h"

+extern unsigned int afl_forksrv_pid;
+
 #ifndef CLONE_IO
 #define CLONE_IO                0x80000000      /* Clone io context */
 #endif
 
@@ -256,7 +259,9 @@ static type name (type1 arg1,type2 arg2,
 #endif

 #ifdef __NR_gettid
-_syscall0(int, gettid)
+// taken from https://patchwork.kernel.org/patch/10862231/
+#define __NR_sys_gettid __NR_gettid
+_syscall0(int, sys_gettid)
 #else
 /* This is a replacement for the host gettid() and must return a host
    errno. */
@@ -6219,7 +6224,8 @@ static void *clone_func(void *arg)
     cpu = ENV_GET_CPU(env);
     thread_cpu = cpu;
     ts = (TaskState *)cpu->opaque;
-    info->tid = gettid();
+    // taken from https://patchwork.kernel.org/patch/10862231/
+    info->tid = sys_gettid();
     task_settid(ts);
     if (info->child_tidptr)
         put_user_u32(info->tid, info->child_tidptr);
@@ -6363,9 +6369,11 @@ static int do_fork(CPUArchState *env, un
                mapping.  We can't repeat the spinlock hack used above because
                the child process gets its own copy of the lock.  */
             if (flags & CLONE_CHILD_SETTID)
-                put_user_u32(gettid(), child_tidptr);
+                // taken from https://patchwork.kernel.org/patch/10862231/
+                put_user_u32(sys_gettid(), child_tidptr);
             if (flags & CLONE_PARENT_SETTID)
-                put_user_u32(gettid(), parent_tidptr);
+                // taken from https://patchwork.kernel.org/patch/10862231/
+                put_user_u32(sys_gettid(), parent_tidptr);
             ts = (TaskState *)cpu->opaque;
             if (flags & CLONE_SETTLS)
                 cpu_set_tls (env, newtls);
@@ -11402,7 +11410,8 @@ abi_long do_syscall(void *cpu_env, int n
         break;
 #endif
     case TARGET_NR_gettid:
-        ret = get_errno(gettid());
+        // taken from https://patchwork.kernel.org/patch/10862231/
+        ret = get_errno(sys_gettid());
         break;
 #ifdef TARGET_NR_readahead
     case TARGET_NR_readahead:
     
     
     #ifdef TARGET_NR_stime /* not on alpha */
       case TARGET_NR_stime:
             {
                  time_t host_time;
                  if (get_user_sal(host_time, argl))
                       return -TARGET_EFAULT;
                struct timespec res;
                res.tv_sec = host_time;
                return get_errno(clock_settime(CLOCK_REALTIME, &res));
             }
#endif


gawk: fatal: cannot use gawk builtin `namespace' as variable name
sub (/\#.+/, "")替换
sub (/#.+/, "");
namespace 替换pkg_namespace

_STAT_VER

https://www.qiniu.com/qfans/qnso-32908047
rtspsrc location=<...> ! rtph264depay ! queue max-size-buffers=0 max-size-bytes=0 max-size-time=$MAX_DELAY ! queue max-size-time=$SMALL_DELAY min-threshold-time=$DELAY ! decodebin ! autovideosink

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
